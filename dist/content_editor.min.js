/*! content_editor 05-01-2014 */
var EditorState=function(){function a(a){this.stateName=a,this.stateClass="is-"+this.stateName}return a.prototype.initState=function(a){a.$el.addClass(this.stateClass)},a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},EditingState=function(a){function b(){a.call(this,"editing")}return __extends(b,a),b.prototype.initState=function(b){a.prototype.initState.call(this,b)},b.prototype.keydown=function(a,b){(a.isKeyForbidden(this.stateName,b)||a.options.maxLength&&a.options.maxLength<=a.$el.text().length&&8!==b.which)&&(b.preventDefault(),b.stopPropagation())},b.prototype.blur=function(a){a.$el.text().length||a.changeState(PlaceHolderState._instance)},b._instance=new b,b}(EditorState),PlaceHolderState=function(a){function b(){a.call(this,"placeholder")}return __extends(b,a),b.prototype.initState=function(b){var c=b.$el,d=c.data("placeholder");a.prototype.initState.call(this,b),c.empty(),$("<p>",{text:d}).appendTo(c)},b.prototype.mousedown=function(a,b){var c,d;b.preventDefault(),b.stopPropagation(),a.$el.text()===a.$el.data("placeholder")&&(d=document.createRange(),c=window.getSelection(),d.setStart(a.el.childNodes[0],0),d.collapse(!0),c.removeAllRanges(),c.addRange(d))},b.prototype.keydown=function(a,b){var c=a.$el;return a.isKeyForbidden(this.stateName,b)?(b.preventDefault(),b.stopPropagation(),void 0):(c.find(":first-child").text(""),c.removeClass("is-placeholder"),a.changeState(EditingState._instance),void 0)},b._instance=new b,b}(EditorState),ContentEditor=function(){function a(a,b){if(this.el=a,this.options=b,this.forbiddenKeyFnForState={},this.$el=$(a),!this.$el.length)throw"No DOM element found.";this.placeHolderText=this.$el.data("placeholder"),this.placeHolderText&&this.placeHolderText.length?this.changeState(PlaceHolderState._instance):this.changeState(EditingState._instance),this.initListeners()}return a.prototype.changeState=function(a){this.state=a,a.initState(this)},a.prototype.addForbiddenKeyFn=function(a,b){this.forbiddenKeyFnForState[a]=b},a.prototype.isValid=function(){var a,b=!0,c=[];return this.options?(a=this.$el.text().length,this.options.maxLength&&a>this.options.maxLength&&(b=!1,c.push("maxLength")),this.options.minLength&&a<=this.options.minLength&&(b=!1,c.push("minLength")),(!this.options.allowEmpty&&"placeholder"===this.state.stateName||!this.options.allowEmpty&&"placeholder"!==this.state.stateName&&!a)&&(b=!1,c.push("allowEmpty")),{isValid:b,errors:c}):{isValid:!0,errors:[]}},a.prototype.isKeyForbidden=function(a,b){return this.forbiddenKeyFnForState[a]&&this.forbiddenKeyFnForState[a](b)},a.prototype.initListeners=function(){var a=this;this.$el.on("mousedown blur keydown keyup",function(b){var c=a.state[b.type];c&&c.call(a.state,a,b)})},a}();