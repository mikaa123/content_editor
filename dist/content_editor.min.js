/*! content_editor 18-01-2014 */
var EditorState=function(){function a(a,b){this.stateName=a,this.editor=b,this.stateClass="is-"+this.stateName}return a.prototype.initState=function(){this.editor.$el.addClass(this.stateClass)},a.prototype.keydown=function(a){return this.isTypingAllowed(a)?(this.handle(a),void 0):(a.preventDefault(),a.stopPropagation(),void 0)},a.prototype.mousedown=function(a){this.handle(a)},a.prototype.blur=function(a){this.handle(a)},a.prototype.handle=function(a){var b=this[a.type+"Handler"];b&&b.call(this,a)},a.prototype.isTypingAllowed=function(a){var b=this.editor,c=b.options,d=this.isKeyForbidden&&this.isKeyForbidden(a)||!1;return c.maxLength&&"placeholder"!==this.stateName?!d&&b.length()<=c.maxLength||8===a.which:!d},a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},EditingState=function(a){function b(b){a.call(this,"editing",b)}return __extends(b,a),b.prototype.initState=function(){a.prototype.initState.call(this)},b.prototype.blur=function(){this.editor.$el.text().length||this.editor.changeState("placeholder")},b}(EditorState),PlaceHolderState=function(a){function b(b){a.call(this,"placeholder",b)}return __extends(b,a),b.prototype.initState=function(){var b=this.editor.$el,c=b.data("placeholder");a.prototype.initState.call(this),b.empty(),$("<p>",{text:c}).appendTo(b)},b.prototype.mousedownHandler=function(a){var b,c,d=this.editor;a.preventDefault(),a.stopPropagation(),d.$el.text()===d.$el.data("placeholder")&&(c=document.createRange(),b=window.getSelection(),c.setStart(d.el.childNodes[0],0),c.collapse(!0),b.removeAllRanges(),b.addRange(c))},b.prototype.keydownHandler=function(){var a=this.editor.$el;a.find(":first-child").text(""),a.removeClass("is-placeholder"),this.editor.changeState("editing")},b}(EditorState),ContentEditor=function(){function a(a,b){if(this.el=a,this.$el=$(a),this.options=b.options,this.states=b.states||{placeholder:new PlaceHolderState(this),editing:new EditingState(this)},!this.$el.length)throw"No DOM element found.";this.placeHolderText=this.$el.data("placeholder"),this.placeHolderText&&this.placeHolderText.length?this.changeState("placeholder"):this.changeState("editing"),this.initListeners()}return a.prototype.changeState=function(a){if(!a||!this.states[a])throw"Undefined stateName";this.state=this.states[a],this.state.initState()},a.prototype.addForbiddenKeyFn=function(a,b){this.states[a].isKeyForbidden=b},a.prototype.isValid=function(){var a,b=!0,c=[];return this.options?(a=this.$el.text().length,this.options.maxLength&&a>this.options.maxLength&&(b=!1,c.push("maxLength")),this.options.minLength&&a<=this.options.minLength&&(b=!1,c.push("minLength")),(!this.options.allowEmpty&&"placeholder"===this.state.stateName||!this.options.allowEmpty&&"placeholder"!==this.state.stateName&&!a)&&(b=!1,c.push("allowEmpty")),{isValid:b,errors:c}):{isValid:!0,errors:[]}},a.prototype.addState=function(a,b){this.states[a]=b},a.prototype.setStateProperty=function(a,b){var c=this.states[a];c||(c=new EditorState(a,this));for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},a.prototype.length=function(){return this.$el.text().length},a.prototype.initListeners=function(){var a=this;this.$el.on("mousedown blur keydown keyup",function(b){a.state[b.type]&&a.state[b.type](b)})},a}();